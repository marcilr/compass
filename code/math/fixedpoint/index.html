<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>Math Functions</title>
  </head>

  <body bgcolor="FFFFFF">
  
  <center>
  <table noborder width=90%" align="middle">
  <TR><TD>
  
    <h1>16.16 Fixed Point Routines</h1>
    <P>
    Data from the digital compass A/D converators is pulled down as 16-bit values.
    For many of the trigonometry calculations I needed accurate signed values.
    I first looked at using one of the many available floating point packages 
    available for the 8051/52 including a pretty good one from Intel called FP-52.
    Floating point 
    is great if you have a dedicated FPU for the task but on an 8-bit microcontroller
    using floating point values doesn't make a lot of sense. I decided the floating point 
    libraries were just too big and slow.I did some research 
    and discovered fixed point math.  I decided 16.16 fixed point would do the trick. 
    The 16.16 describes how many bits are before and after the decimal point.  This 
    would give me a range of values from -32768.0000 to 32767.9999, this should be
    sufficient for all the compass needs.  There are numerous fixed point routines
    available for the stock standard 486 and Pentium masses but I was hard
    pressed to find a 16.16 fixed point library for the 8051/52, that I didn't
    have to buy of course.
    </P>
    
    <P>
    I wrote my own signed 16.16 fixed point library for the 8052.  The complement,
    shift, add, and subtract functions were relatively easy to right.  But the
    multiply and divide routines were a bear.  I learned quite a bit about
    <A HREF="http://www.ednmag.com/reg/1997/050897/10df_05.htm">
      <I>restoring binary division</I></A>.
    </P>

	 <P>
	 The following table summarizes the 16.16 fixed point and other
	 32-bit routines used:
	 </P>
	 
	 <table border cellpadding=2 cellspacing=1>

		<!-- ====== ADD32 ======== -->
	 	<tr>
	 	  <td><A HREF="files/add32.asm">ADD32</A></td>
	 	  <td>Add two 32-bit numbers to get a 32-bit result</td>
	 	</tr>
	 	
	 	<!-- ====== BIN32CPL ====== -->
	   <tr>
	     <td><A HREF="files/bin32cpl.asm">BIN32CPL</A></td>
	     <td>2's complement of 32-bit number</td>
	   </tr>
	   
	   <!-- ========= COPY32 ======== -->
	   <tr>
	     <td><A HREF="files/copy32.asm">COPY32</A></td>
	     <td>Copies 32-bit value from one RAM location to another.</TD>
	   </tr>
	   
	   <!-- ========= COPY32P ======= -->
	   <tr>
	     <td><A HREF="files/copy32p.asm">COPY32P</A></TD>
	     <td>Copies 32-bit value from program memory to RAM.
	   </tr>
	   
	   <!-- ========= DIV32 ====== -->
	   <tr>
	     <td><A HREF="files/div32.asm">DIV32</A></td>
	     <td>32-bit by 32-bit divide, yields 32-bit quotient and remainder</td>  
	   </tr>
	   
	   <!-- ========= FDIVS ========= -->
	   <tr> 
	     <td><A HREF="files/fdivs.asm">FDIVS</A></td>
	     <td>Signed 16.16 by 16.16 division, yields signed 16.16 result</td>
	   </tr>
	   
	   <!-- ========= FDIV ========== -->
	   <tr>
	     <td><A HREF="files/fdiv.asm">FDIV</A></td>
	     <td>Unsigned 16.16 by 16.16 division, yields unsigned 16.16 result</td>
	   </tr>
	   
	   <!-- ========= GT ============ -->
	   <tr>
	     <td><A HREF="files/gt32.asm">GT32</A></td>
	     <td>32-bit unsigned Greater Than function</td>
	   </tr>
	     
	   <!-- ========= GTE =========== -->
	   <tr>
	     <td><A HREF="files/gte32.asm">GTE32</A></td>
	     <td>32-bit unsigned Greater Than or Equal to function</td> 
	   </tr>
	   
	   <!-- ========= FMUL ========== -->
	   <tr>
	     <td><A HREF="files/fmul.asm">FMUL</A></td>
	     <td>Unsigned 16.16 by 16.16 multiply, yields unsigned 16.16 result</td>
	   </tr>
	   
	   <!-- ======== SHIFT32 ========= -->
	   <tr>
	     <td><A HREF="files/shift32.asm">SHIFT32</A>
	     <td>Shift unsigned 32-bit value right or left an arbitrary amount</td>
	   </tr>
	   
	   <!-- ======== SHIFT32L ======== -->
	   <tr>
	     <td>
	       <A HREF="files/shift32l.asm">SHIFT32L</A>
	     </td>
	     <td>Shift 32-bit value left 1 bit</td>
	   </tr>
	   
	   <!-- ======== SHIFT32R ======== -->
	   <tr>
	     <td><A HREF="files/shift32r.asm">SHIFT32R</A>
	     <td>Shift 32-bit value right 1 bit</td>
	   </tr>
	   
	   <!-- ======== SHIFT32S ======== -->
	   <tr>
	     <td><A HREF="files/shift32s.asm">SHIFT32S</A>
	     <td>Shifts signed 32-bit value right/left arbitrary amount, preserves sign</A>
	   
	   </tr>
	 </table>

    <table noborder><tr><td>&nbsp;</td></tr></table>
    
       <hr>
    <address><a href="mailto:marcilr@saturn.math.uaa.alaska.edu">Raymond E. Marcil</a></address>
    <!-- Created: Fri Apr 14 18:18:12 AKST 2000 -->
    <!-- hhmts start -->
    Last modified: Fri Apr 14 18:18:12 AKST 2000
    <!-- hhmts end -->

    </TD></TR>
    </TABLE>
    </center>
 
  </body>
</html>
